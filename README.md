# datasets-harmonization

This repository contains code and documentation for the harmonization of cohorts participating in the CGMHC.

**Please note: The content in this repository currently reflects a pilot analysis. The scripts, documentation, and results will be continuously updated as the project progresses towards larger-scale harmonization.**

The primary focus of this pilot is on the **English Longitudinal Study of Ageing (ELSA-UK)** and the **Estudo Longitudinal de Sa√∫de do Adulto (ELSA-Brasil)**.

## Repository Structure

This repository is organized into the following directories:

-   `/scripts`: Contains the R scripts used for data preparation, analysis, and visualization. Each version of the script reflects a different stage or approach in the analysis pipeline. 
-   `/output`: Contains the results generated by the analysis scripts. This includes model summaries, fit statistics, tables, and plots (`.html`, `.pdf`, etc.).

## Pilot analysis Overview

The R scripts currently in the `/scripts` folder perform a **pilot analysis** for the project. This pilot uses **Multi-group Confirmatory Factor Analysis (MGCFA) to test measurement invariance** and assess whether the constructs of depression and anxiety are measured in the same way across the ELSA-UK and ELSA-Brasil cohorts.

The main steps are:

1.  **Setup**: Loads all necessary R packages, including `tidyverse` for data manipulation, `lavaan` and `semTools` for structural equation modeling, and `haven` for reading data.
2.  **Data Loading & Pre-processing**:
    -   Reads the recoded datasets for depression and anxiety from both cohorts.
    -   Performs necessary data cleaning, such as standardizing column names (`id`), changing data types, and adding a `cohort` variable.
    -   Merges the two cohort datasets into a single file for each mental health outcome.
3.  **Measurement Invariance Testing (MGCFA)**:
    -   Sequentially tests for **configural**, **metric**, and **scalar** invariance for both anxiety and depression models.
    -   The models are specified using `lavaan` syntax, accounting for the longitudinal nature of the data and the ordered categorical nature of the indicators (`estimator = "wlsmv"`).
4.  **Factor Score Extraction**:
    -   After establishing the best-fitting model, it uses `lavPredict` to estimate and save the latent factor scores.
5.  **Visualization**:
    -   Generates path diagrams for the CFA models using the `semPaths` function.

As the project advances, these scripts will be updated to include more cohorts and potentially different harmonization techniques.

## How to Run the Analysis

1.  **Clone the repository**:
    ```bash
    git clone [YOUR_REPOSITORY_URL]
    ```
2.  **Place Datasets**: Obtain the necessary `.rds` files (`elsauk_recoded_dep.rds`, `elsauk_recoded_anx.rds`, etc.) and place them in the `/data` directory.
3.  **Set Working Directory**: Open the R script from the `/scripts` folder and ensure the working directory is set to the root of the cloned repository.
    ```r
    # Example:
    # setwd("C:/Users/YourUser/Documents/GitHub/your-repository-name")
    ```
4.  **Install Dependencies**: Make sure you have all the required R packages installed.
    ```r
    install.packages(c("tidyverse", "lavaan", "haven", "foreign", "mice", "readr", "semTools", "semPlot"))
    ```
5.  **Execute the Script**: Run the entire script to replicate the analysis. The output files will be saved in the `/output` directory.
